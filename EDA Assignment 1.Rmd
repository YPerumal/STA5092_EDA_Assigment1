---
title: "STA5092Z: Assigment 1"
author: "Yevashan Perumal"
date: "3/30/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(ggplot2)
```

##Summary of data
The data set is availale at the following link:
https://zivahub.uct.ac.za/articles/dataset/Southern_Pied_Babbler_nestling_mass_tarsus_length_and_survival/12441899

Data were collected for each austral summer breeding season from September 2005Febru- ary 2019 (14 breeding seasons in total).

##Part 1 - Data Wrangling


```{r Import Data q2}
# First Import Nestling comes first
df1 <- read.csv("./Datasets/Data.Bourne_NestlingsAllData.csv", header = TRUE)
df1 <- tibble(df1) #Convert to tibble


# Second import Fledgeling comes second
df2 <- read.csv("./Datasets/Data.Bourne_FledglingSurvival.csv", header = TRUE)
df2 <- tibble(df2) #Convert to tibble



# Third Import
df3 <- read.csv("./Datasets/Data.Bourne_NestSuccess.csv", header = TRUE)
df3 <- tibble(df3)  #Convert to tibble
```

A preview of the dataset named Data.Bourne_NestlingsAllData.csv
```{r merge two datasets q3 }
head(df1,5)
# sum(is.na(df1$Date)) #No nulls in the date column
```


A preview of the dataset named Data.Bourne_FledglingSurvival.csv
```{r  merge two datasets q3 }
head(df2,5)
# sum(is.na(df2$Date)) #No nulls in the date column
```
A preview of the dataset named Data.Bourne_NestSuccess.csv:
```{r}
head(df3,5)
```

Before merging the Nestling and Fledgling dataframes, several actions need to be taken to cleanse the data and make it ready. They are detailed below:
### Fledgeling data
-Convert all date related fields from character  to date format
-Remove any potential whitespace from character fields
-convert Surv1Mass,GrpSizeAD,GrpSizeTotal and X.Imm to numeric type from character.
-Renaming GRP to Group

### Nestling data
-Convert date related field to date format
-Convert Surv1Mass to numeric
-Remove whitespaces from character fields

It does appear from NAs were introduced during the data conversion of characater to numeric, which are for fields that did not have any data to start with.

```{r clean up dataframes q1.3}
df1 <- df1 %>% 
    rename(Group=GRP)%>% 
    mutate(Date = dmy(Date),
           TwoMonthsPrior =dmy(TwoMonthsPrior),
           IncDate =dmy(IncDate),
           HatchDate =dmy(HatchDate),
           FledgeDate =dmy(FledgeDate),
           FailDate =dmy(FailDate),
           IndepDate =dmy(IndepDate),
           X1YrDate =dmy(X1YrDate),
           X2YrDate =dmy(X2YrDate),
           Surv1Mass=as.numeric(Surv1Mass),
           BirdID = str_replace_all(BirdID, " ", ""),
           Group=str_replace_all(Group, " ", ""),
           Season=str_replace_all(Season, " ", ""),
           NestID=str_replace_all(NestID, " ", ""),
           GrpSizeAD=as.numeric(GrpSizeAD),
           GrpSizeTotal=as.numeric(GrpSizeTotal),
           X.Imm=as.numeric(X.Imm)
           )%>%
    arrange(BirdID,Date,Group,Season)

df2 <- df2 %>%
    mutate(Date = dmy(Date),
           Surv1Mass=as.numeric(Surv1Mass),
           BirdID = str_replace_all(BirdID, " ", ""),
           Group=str_replace_all(Group, " ", ""),
           Season=str_replace_all(Season, " ", ""),
           NestID=str_replace_all(NestID, " ", ""),) %>% 
    arrange(BirdID,Date,Group,Season)


```

```{r merge q1.3}
#V1
# Spiedbabbler <- df1%>% left_join(df2,by=c('Date','BirdID','Group','Season','NestID'))

# V2
Spiedbabbler <- df1%>% left_join(df2)
# head(Spiedbabbler,5)
# print(dim(df1))
# print(dim(df2))
# print(dim(Spiedbabbler))
#Nestling comes first!
d < dim(Spiedbabbler)
```
The dimensions of the merged data set are  `r d[1]` rows and `rd[2]` columns.

##Part 2
The Total Sample Size Per Year:
```{r q2.1}
#Total Sample Size Per Year
size_per_year <-Spiedbabbler %>%
    mutate(year=year(Date)) %>%
    select(c(year,BirdID))%>%
    group_by(year)%>%
    summarise(n = n())
    # summarise(sample_size==count(BirdID))


# print(size_per_year)
#Print as a table
knitr::kable(
  size_per_year, 
  caption = "The Total Sample Size Per Year"
)
```

```{r q2.2 outliers}
#Check for nulls per column
miss_val <-Spiedbabbler %>%
    select(c(GrpSizeAD,GrpSizeTotal,BroodSize,Mass,TMaxMeas,
             No.ChicksFledge,TotRain,Drought))%>%
    sapply(function(x) sum(is.na(x)))
#Print in a nice table?
miss_val

# Looking for outliers


# Spiedbabbler %>%
#     select(c(GrpSizeAD,GrpSizeTotal,BroodSize,Mass,TMaxMeas,
#              No.ChicksFledge,TotRain,Drought))%>%
#     boxplot()

b1<-Spiedbabbler %>%
    select(c(GrpSizeAD,GrpSizeTotal,BroodSize,Mass,TMaxMeas,
             No.ChicksFledge,TotRain,Drought))%>%
    ggplot(aes(x=GrpSizeAD))+
    geom_boxplot()

b2 <- Spiedbabbler %>%
    select(c(GrpSizeAD,GrpSizeTotal,BroodSize,Mass,TMaxMeas,
             No.ChicksFledge,TotRain,Drought))%>%
    ggplot(aes(y=GrpSizeTotal))+
    geom_boxplot()
library(ggplot2)
?boxplot
figure <- ggarrange(b1, b1, lp,
                    labels = c("A", "B"),
                    ncol = 2, nrow = 2)
op <- par(mfrow = c(2, 2))   
Spiedbabbler %>%
    select(c(GrpSizeAD,GrpSizeTotal,BroodSize,Mass,TMaxMeas,
             No.ChicksFledge,TotRain,Drought))%>%
    ggplot(aes(x=GrpSizeAD))+
    geom_boxplot()

Spiedbabbler %>%
    select(c(GrpSizeAD,GrpSizeTotal,BroodSize,Mass,TMaxMeas,
             No.ChicksFledge,TotRain,Drought))%>%
    ggplot(aes(y=GrpSizeTotal))+
    geom_boxplot()
par(op)
```
Definition of an outlier is those that are more than 3???? standard deviations away from the mean

```{r q2.3 outliers}
# ????? The Question here is so vague!

Spiedbabbler%>%
    select(NestID,Date,Mass)
    group_by(NestID)

```

NEED TO COME BACK TO THIS ONE
```{r q2.4} 
head(Spiedbabbler)
unique(Spiedbabbler$Season)


# Spiedbabbler%>%
#     select(Season,TMaxMeas,TMinMeas,TvarMeas)
#     na.omit()%>%
   # summarise(average_high_temp=mean(TMaxMeas),average_low_temp=mean(TMinMeas))%>%
       
Spiedbabbler%>%
    select(Date,Season,TMaxMeas,TMinMeas)%>%
    ggplot(aes(x=Date,y=TMaxMeas,color=Season))+
    geom_point(na.rm = T)
```


```{r q2.5 }
Spiedbabbler%>%
    select(NestID,Date,Mass,Season)%>%
    group_by(NestID,Date,Season)%>%
    summarise(avg_mass=mean(Mass))%>%
    ggplot(aes(x=Date,y=avg_mass,color=Season))+
    geom_point()+
    facet_wrap(~Season)

```

```{r q2.6}
Spiedbabbler%>%
    mutate(year=year(Date))%>%
    select(year,Mass,BroodSize,GrpSizeTotal,No.ChicksFledge,TotRain,Season,Drought)%>%
    group_by(year,Season)%>%
    summarise(avg_mass=mean(Mass),mean_broodsize=mean(BroodSize),
              avg_grp_size=mean(GrpSizeTotal),avg_fledg_count=mean(No.ChicksFledge),
              avg_rain=mean(TotRain))%>%
    ggplot(aes(x=year))+
    geom_point(aes(y=avg_mass))+
    facet_grid(~Season)

# str(Spiedbabbler)
```

```{r q2.7}

```


